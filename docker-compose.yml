version: '3.8'

services:
  experiments:
    image: pikalab/automl-fairness:latest
    build:
      context: .
      dockerfile: Dockerfile
    volumes:
      - mmagnini:/home/dev/persistent
    command: |
      sh -c '
      find experiments/setup -name "*.yml" | \
      while read filepath; do \
        filename=$(echo "$filepath" | sed "s:.*/::"); \
        poetry run python -m experiments "$filename"; \
      done
      '

volumes:
  mmagnini:
    external: true
    name: mmagnini
